/**
 * HTTP Service for KaraCos 
 * 
 * By Nicolas Karageuzian
 * 
 * This file is part of KaraCos.
 *
 * KaraCos is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * any later version.
 *
 * KaraCos is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with KaraCos.  If not, see <http://www.gnu.org/licenses/>.
 */
var log4js = require('log4js')(),
	karacos = require('karacos');

logger = log4js.getLogger('karacos.http.service');


exports.processor = require('./processor.js')
exports.server = require('./HttpServer.js');


karacos.model.Domain.get_by_name("sysdomain", function(get_err,expected_domain) {
	logger.debug('Looking for sysdomain');
	if (expected_domain === undefined) {
		logger.debug('sysdomain not found, creating');
		karacos.model.Domain.create({
			name: 'sysdomain',
			fqdn: 'localhost:1337'
		},function(create_err,newdomain) {
			logger.debug('sysdomain created');
			exports.sysdomain = newdomain;
		});
	} else {
		logger.debug('sysdomain found');
		exports.sysdomain = expected_domain;
	}
});