var redis = require("redis"),
	client,
	redis2json = require("../../deps/redis2json"),
	karacos = require('karacos');
redis2json.redis = redis;

getClient = function() {
	if (typeof client === "undefined") {
		client = redis.createClient(1338, "127.0.0.1");
	}
	return client;
};

exports.get = function(id, callback) {
	var val,
		doc, map, variable, model;
	
	getClient().get(id, function(err, res) {
		var variable;
		if (typeof err !== "undefined") {
			val = res;
			if (val in karacos.model) {
				model = karacos.model[val],
				map = model.map;
				variable = {id: id};
				redis2json.load(map, variable, function (error, result) {
					console.log(result);
					callback(undefined, new model(result));
				});
			} else {
				callback(undefined, val);
			}
		} else {
			callback(err);
		}
	});
};

exports.getClient = getClient;